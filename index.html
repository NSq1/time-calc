---
layout: default
toc: false
---
<script>{% include time_calc_customize.js %}</script>
<table class="timecalc">
    <tr>
        <td>INPUT</td>
        <td><table class="input">
            <tr class="from">
                <td>FROM</th>
                <td>
                    <input class="date" type="text"/>
                    <input class="time" type="text"/>
                    <input class="now" type="button" value="NOW"/>
                    <input class="toggle from" type="button" value=" "/>
                </td>
            </tr>
            <tr class="to">
                <td>TO</th>
                <td>
                    <input class="date" type="text"/>
                    <input class="time" type="text"/>
                    <input class="now" type="button" value="NOW"/>
                    <input class="toggle to" type="button" value=" "/>
                </td>
            </tr>
        </table></td>
    </tr>
    <tr >
        <td>GMT</td>
        <td><table class="gmt">
            <tr class="from">
                <td>FROM</td>
                <td class="value"></td>
            </tr>
            <tr class="to">
                <td>TO</td>
                <td class="value"></td>
            </tr>
        </table></td>
    </tr>
    <tr >
        <td>ISO</td>
        <td><table class="iso">
            <tr class="from">
                <td>FROM</td>
                <td class="value"></td>
            </tr>
            <tr class="to">
                <td>TO</td>
                <td class="value"></td>
            </tr>
        </table></td>
    </tr>
    <tr><td>OUTPUT</td>
        <td><table class="output">
            <tr class="type"><td>type:</td><td class="value" colspan="3"></td></tr>
            <tr class="days"><td>days:</td><td class="value"></td><td>with</td><td class="rest"></td></tr>
            <tr class="hours"><td>hours:</td><td class="value"></td><td>with</td><td class="rest"></td></tr>
            <tr class="minutes"><td>minutes:</td><td class="value"></td><td>with</td><td class="rest"></td></tr>
            <tr class="seconds"><td>seconds:</td><td class="value"></td><td>with</td><td class="rest"></td></tr>
            <tr class="miliseconds"><td>miliseconds:</td><td class="value"></td><td>with</td><td class="rest"></td></tr>
        </table></td>
    </tr>
</table>
<div id="output"/>
<script>
var GetURLParameter = function (sParam){
    var sPageURL = window.location.search.substring(1);
    var sURLVariables = sPageURL.split('&');
    for (var i = 0; i < sURLVariables.length; i++){
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam){
            return sParameterName[1];
        }
    }
};


$.getScript('//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js', function(){
    $(".time").timepicker({
        timeFormat: 'HH:mm:ss',
        dynamic: false,
        dropdown: true,
        scrollbar: true,
        change: function(time){timecalc.refresh();},
    });
});
$.getScript('assets/js/jquery-ui.js', function(){
    $( ".date" ).datepicker({
        dateFormat: "yy-mm-dd",
    }); 
});

var timecalc = {
    src : $('.timecalc'),
    base : {
        ms : 1,
        s : 1000,
        m : 1000*60,
        h : 1000*60*60,
        d : 1000*60*60*24,
        mm : 1000*60*60*24*30,
        y : 1000*60*60*24*365,
    },
    toggle : function(target,handler){
        $(target).toggleClass('off').toggleClass('on');
        handler($(target).hasClass('on'));
    },
    get : function(source){
        let result = new Date(Date.parse($(source).find('.date').val()));
        let deltaTime = $(source).find('.time').val().split(':');
        let hours = deltaTime[0]!=='' ? deltaTime[0] : 0;
        let minutes = deltaTime.length>0 ? deltaTime[1] : 0;
        let seconds =  deltaTime.length>1 ? deltaTime[2] : 0;
        return new Date(result.setHours(hours, minutes, seconds));
    },
    set : function(target, value){
        $(target).find('.date')
            .val(timecalc.date(value))
            .trigger('change');
        $(target).find('.time')
            .val(timecalc.time(value))
            .trigger('change');
    },
    from : function(value){
        if (value!==undefined){
            timecalc.set('.input .from', value);
        }
        return timecalc.get('.input .from');
    },
    to : function(value){
        if (value!==undefined){
            timecalc.set('.input .to', value);
        }
        return timecalc.get('.input .to');
    },
    date : function(timestamp){
        let dt = new Date(timestamp);
        return dt.getUTCFullYear() + '-' 
            + (dt.getUTCMonth()+1 < 10 ? '0'+(dt.getUTCMonth()+1) : dt.getUTCMonth()+1) + '-' 
            + (dt.getUTCDate()<10 ? '0'+dt.getUTCDate() : dt.getUTCDate());
    },
    time : function(timestamp){
        let dt = new Date(timestamp);
        return (dt.getHours() < 10 ? '0'+dt.getHours() : dt.getHours()) +':'
            + (dt.getMinutes() < 10 ? '0'+dt.getMinutes() : dt.getMinutes()) + ':'
            + (dt.getSeconds() < 10 ? '0'+dt.getSeconds() : dt.getSeconds()) ;
    },
    clock : {
        intervals : {},
        interval : function(target, state, frequency){
            if (this.intervals[target]!==undefined){
                clearInterval(this.intervals[target]);
            }
            if (state === undefined || state){
                timecalc.set(target, new Date());
                this.intervals[target]=setInterval(
                        function(){
                            timecalc.set(target, new Date());
                        }, 
                        frequency===undefined ? 1000 : frequency);
            };
        },

    },
    timer : {
        ticks : 0,
        type : '???',
        calc : function(){
            let from = timecalc.from().getTime();
            let to = timecalc.to().getTime();
            return from > to ? from - to : to - from;            
        },
        determineType : function(){
            return timecalc.from().getTime()<timecalc.to().getTime()
                ?'future'
                :timecalc.from().getTime()>timecalc.to().getTime()
                    ?'past'
                    :'now';
        },
        refresh : function(){
            this.ticks = this.calc();
            this.type = this.determineType();
        },
        total : {
            miliseconds : function(){return timecalc.timer.ticks;},
            seconds : function(){return Math.floor(timecalc.timer.ticks/timecalc.base.s);},
            minutes : function(){return Math.floor(timecalc.timer.ticks/timecalc.base.m);},
            hours : function(){return Math.floor(timecalc.timer.ticks/timecalc.base.h);},
            days : function(){return Math.floor(timecalc.timer.ticks/timecalc.base.d);},
        },
        parts : {
            miliseconds : function(){return Math.floor((timecalc.timer.ticks%timecalc.base.s)/timecalc.base.ms);},
            seconds : function(){return Math.floor((timecalc.timer.ticks%timecalc.base.m)/timecalc.base.s);},
            minutes : function(){return Math.floor((timecalc.timer.ticks%timecalc.base.h)/timecalc.base.m);},
            hours : function(){return Math.floor((timecalc.timer.ticks%timecalc.base.d)/timecalc.base.h);},
            days : function(){return Math.floor((timecalc.timer.ticks)/timecalc.base.d);},
        },
    },
    gmt : {
        from : function(){return timecalc.from().toString()},
        to : function(){return timecalc.to().toString()},
    },
    iso : {
        from : function(){return timecalc.from().toISOString()},
        to : function(){return timecalc.to().toISOString()},
    },
    refresh : function(){
        timecalc.timer.refresh();
        timecalc.repaint.run(this.src);
    },
    repaint : {
        run : function(src){
            try{
                this.gmt(src);
                this.iso(src);
                this.values(src);
                this.rest(src);
                this.type(src);
            } catch (e){
                console.log(e);
            }
        },
        type : function(src){
            src.find('.output .type .value')
                .attr('text',timecalc.timer.type)
                .text(timecalc.timer.type);
        },
        values : function(src){
            src.find('.output .miliseconds .value').text(timecalc.timer.total.miliseconds());
            src.find('.output .seconds .value').text(timecalc.timer.total.seconds());
            src.find('.output .minutes .value').text(timecalc.timer.total.minutes());
            src.find('.output .hours .value').text(timecalc.timer.total.hours());
            src.find('.output .days .value').text(timecalc.timer.total.days());
        },
        rest : function(src){
            src.find('.output .miliseconds .rest').text('---');
            src.find('.output .seconds .rest').text(timecalc.timer.parts.miliseconds()+'[ms]');
            src.find('.output .minutes .rest').text(timecalc.timer.parts.seconds()+'[s] ' + timecalc.timer.parts.miliseconds()+'[ms]');
            src.find('.output .hours .rest').text(timecalc.timer.parts.minutes()+'[m] ' + timecalc.timer.parts.seconds()+'[s] ' + timecalc.timer.parts.miliseconds()+'[ms]');
            src.find('.output .days .rest').text(timecalc.timer.parts.hours()+'[h] '+timecalc.timer.parts.minutes()+'[m] ' + timecalc.timer.parts.seconds()+'[s] ' + timecalc.timer.parts.miliseconds()+'[ms]');
        },
        iso : function(src){
            src.find('.iso .from .value').text(timecalc.iso.from());
            src.find('.iso .to .value').text(timecalc.iso.to());
        },
        gmt : function(src){
            src.find('.gmt .from .value').text(timecalc.gmt.from());
            src.find('.gmt .to .value').text(timecalc.gmt.to());
        },
    }
};  

$('.from, .to').on('change', 
    function(){
        timecalc.refresh();
    });
$('.now').on('click',
    function(){
        $(this).parent().find('.date')
            .val(timecalc.date($.now()))
            .trigger('change')
            .parent().find('.time')
            .val(timecalc.time($.now()))
            .trigger('change');
    })
$('.toggle').on('click',
    function(){
        if ($(this).hasClass('from')){
            timecalc.toggle(this,function(state){
                timecalc.clock.interval('.input .from',state,1000);
            });
        }
        if ($(this).hasClass('to')){
            timecalc.toggle(this,function(state){
                timecalc.clock.interval('.input .to',state,1000);
            });
        }
    });
$(document).on('ready', 
    function(){
        let from = GetURLParameter('from');
        let to = GetURLParameter('to');
        let delta = GetURLParameter('delta');
        if (from==='on'){
            $('.from .toggle').trigger('click');
        } else if (from==='now'){
            $('.from .now').trigger('click');
        } else if (from==='delta' && delta!==undefined){
            timecalc.from(new Date(new Date().getTime()+Number(delta)*1000));
        }
        if (to==='on'){
            $('.to .toggle').trigger('click');
        } else if (to==='now'){
            $('.to .now').trigger('click');
        } else if (to==='delta' && delta!==undefined){
            timecalc.to(new Date(new Date().getTime()+Number(delta)*1000));
        }
        console.log(from);
    });
</script>